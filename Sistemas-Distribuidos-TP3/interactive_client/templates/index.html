<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cliente Interativo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        async function sendMessage(operation) {
            const input = document.getElementById("message");
            const logArea = document.getElementById("log");
            const msg = input.value.trim();

            if (!msg) {
                alert("Digite uma mensagem antes de enviar!");
                return;
            }

            // Concatenando comando + mensagem
            const fullMessage = `${operation} ${msg}`;

            logArea.value += `[Cliente] Enviando: ${fullMessage}\n`;

            try {
                const response = await fetch("/", {
                    method: "POST",
                    body: new URLSearchParams({message: fullMessage}),
                });

                const data = await response.json();

                if (data.status === "success") {
                    logArea.value += `[Servidor] ✅ Mensagem COMMITED: "${data.message}"\n`;
                } else {
                    logArea.value += `[Servidor] ❌ Erro: ${data.message}\n`;
                }

            } catch (err) {
                logArea.value += `[Erro] Falha na comunicação: ${err}\n`;
            }

            logArea.scrollTop = logArea.scrollHeight;
            input.value = ""; // limpa o input após enviar
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Cliente Interativo</h1>

        <!-- Campo de mensagem e botões -->
        <input type="text" id="message" placeholder="Digite sua mensagem aqui..." autocomplete="off">
        <div id="buttons">
            <button type="button" onclick="sendMessage('create')">Create</button>
            <button type="button" onclick="sendMessage('append')">Append</button>
            <button type="button" onclick="sendMessage('delete')">Delete</button>
        </div>

        <!-- Log -->
        <textarea id="log" readonly placeholder="Logs aparecerão aqui..." style="width:100%; height:300px; margin-top:10px;"></textarea>
    </div>
</body>
</html>